<div class="generator-container fade-in">
  
  <mat-card class="form-card">
    <div class="decorative-bar"></div>
    <mat-card-header>
      <mat-card-title>Create Curriculum</mat-card-title>
      <mat-card-subtitle>Configure your AI-generated learning path</mat-card-subtitle>
    </mat-card-header>
    
    <mat-card-content>
      <div class="form-grid">
        <div class="form-col">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Lesson Type</mat-label>
            <mat-select [(ngModel)]="lessonType">
              <mat-option *ngFor="let type of lessonTypes" [value]="type">{{ type }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Plan Name</mat-label>
            <input matInput [(ngModel)]="planName" placeholder="e.g. Intro to Python" required>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width" *ngIf="lessonType === 'Language'">
            <mat-label>Native Language</mat-label>
            <input matInput [(ngModel)]="nativeLanguage" placeholder="e.g. Ukrainian, Spanish">
          </mat-form-field>
        </div>

        <div class="form-col">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Topic</mat-label>
            <input matInput [(ngModel)]="topic" placeholder="e.g. Data Structures" required>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Duration (Days)</mat-label>
            <input matInput type="number" [(ngModel)]="numberOfDays" min="1" max="30">
          </mat-form-field>
        </div>

        <div class="form-full">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Description & Goals</mat-label>
            <textarea matInput [(ngModel)]="description" rows="4" placeholder="Describe what you want to achieve..."></textarea>
          </mat-form-field>
        </div>
      </div>

      <div class="error-banner" *ngIf="error">
        <mat-icon>warning</mat-icon>
        <span>{{ error }}</span>
      </div>
    </mat-card-content>

    <mat-card-actions align="end">
      <button mat-button (click)="resetForm()">Reset</button>
      <button mat-raised-button color="primary" class="generate-btn" (click)="generateLessonPlan()" [disabled]="isLoading">
        <mat-spinner diameter="20" *ngIf="isLoading" class="spinner-white"></mat-spinner>
        <span *ngIf="!isLoading">Generate Plan</span>
        <mat-icon *ngIf="!isLoading" class="btn-icon-right">auto_awesome</mat-icon>
      </button>
    </mat-card-actions>
  </mat-card>

  <!-- Results Section -->
  <div class="results-area" *ngIf="generatedPlan">
    <div class="results-header">
      <div class="plan-meta">
        <h2>{{ generatedPlan.planName }}</h2>
        <mat-chip-set>
          <mat-chip>{{ generatedPlan.topic }}</mat-chip>
          <mat-chip class="count-chip">{{ generatedPlan.lessons.length }} Lessons</mat-chip>
        </mat-chip-set>
      </div>
      
      <div class="plan-actions">
        <button mat-stroked-button (click)="downloadJson()">
          <mat-icon>download</mat-icon> JSON
        </button>
        <button mat-raised-button color="accent" (click)="saveLessonPlan()" [disabled]="isSaving">
          <mat-spinner diameter="20" *ngIf="isSaving"></mat-spinner>
          <span *ngIf="!isSaving">Save to Library</span>
        </button>
      </div>
    </div>

    <div class="success-message" *ngIf="saveSuccess">
      <mat-icon>check_circle</mat-icon> Plan saved successfully!
    </div>

    <div class="lessons-grid">
      <mat-card class="lesson-result-card" *ngFor="let lesson of generatedPlan.lessons">
        <div class="card-left">
          <div class="index-badge">{{ lesson.lessonNumber }}</div>
        </div>
        <div class="card-right">
          <h3 class="result-title">{{ lesson.name }}</h3>
          <p class="result-desc">{{ lesson.shortDescription }}</p>
        </div>
      </mat-card>
    </div>
  </div>
</div>